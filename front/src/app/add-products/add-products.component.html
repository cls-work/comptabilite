<!-- Editable table -->
<div class="card" >
  <h3 class="card-header text-center font-weight-bold text-uppercase py-4">Ajouter des produits</h3>


  <ul class="list-group">
    <li class="list-group-item">  <h3>Réference facture : </h3>  <h5>{{bill.billId}}</h5> </li>
    <li class="list-group-item">  <h3>Fournisseur : </h3> <h5>{{bill.provider}}</h5></li>
    <li class="list-group-item">  <h3>Date : </h3> <h5>{{bill.date}}</h5></li>
  </ul>




  <div class="card-body">
    <div id="table" class="table-editable">
      <span class="table-add float-right mb-3 mr-2">
        <a class="text-success" (click)="addProduct()">
        </a>
      </span>

      <form [formGroup]="productsForm">
        <div formArrayName="products" >

          <table class="table table-bordered table-responsive-md table-striped text-center">


            <tr>
              <th class="text-center">Designation</th>
              <th class="text-center">Qté</th>
              <th class="text-center" *ngIf="taxType==0">Prix Unitaire HT</th>
              <th class="text-center" *ngIf="taxType==1">Prix Unitaire TTC</th>
              <th class="text-center">Réduction</th>
              <th class="text-center">TVA</th>
              <th class="text-center" *ngIf="taxType==0">Prix Unitaire HT après réduction</th>
              <th class="text-center" *ngIf="taxType==1">Prix Unitaire TTC après réduction</th>
              <th class="text-center">Montant HT</th>
              <th class="text-center">Montant TVA</th>
              <th class="text-center">Montant TTC
              <th> <i class="fa fa-plus"  (click)="addProduct()"></i></th>

            </tr>

            <tr *ngFor="let product  of products.controls; let i = index" [formGroupName]="i">


              <td>
                <input type="text" required formControlName="designation"
                       [class.alert-danger]="products.controls[i].controls.designation.invalid&&(products.controls[i].controls.designation.dirty||products.controls[i].controls.designation.touched)"
                       class="form-control col" placeholder="Désignation" aria-describedby="basic-addon2">
              </td>
              <td>
                <input type="number" required formControlName="quantity"
                       [class.alert-danger]="products.controls[i].controls.quantity.invalid&&(products.controls[i].controls.quantity.dirty||products.controls[i].controls.quantity.touched)"
                       class="form-control col" id="quantity" placeholder="Qté" (change)="calculatePrices(i)">
              </td>
              <td>
                <input type="number" required formControlName="unitPrice"
                       [class.alert-danger]="products.controls[i].controls.unitPrice.invalid&&(products.controls[i].controls.unitPrice.dirty||products.controls[i].controls.unitPrice.touched)"
                       class="form-control col" placeholder="Prix Unitaire" id="unitPrice" (change)="calculatePrices(i)">
              </td>
              <td>
                <div class="input-group col ">
                  <input type="number" required formControlName="discount"
                         [class.alert-danger]="products.controls[i].controls.discount.invalid&&(products.controls[i].controls.discount.dirty||products.controls[i].controls.discount.touched)"
                         class="form-control col" id="discount" placeholder="Réduction" (change)="calculatePrices(i)">
                  <span class="input-group-text" >%</span></div>
              </td>

              <td>
                <div class="input-group col ">
                  <input type="number" required formControlName="tva"
                         [class.alert-danger]="products.controls[i].controls.tva.invalid&&(products.controls[i].controls.tva.dirty||products.controls[i].controls.tva.touched)"
                         class="form-control col" id="tva" (change)="calculatePrices(i)" placeholder="TVA">


                  <div class="input-group-prepend">
                    <span class="input-group-text" >%</span>
                  </div>
                </div>
              </td>
              <td>
                <input type="number" required formControlName="unitPriceAfterDiscount" class="form-control col" id="unitPriceAfterDiscount" readonly [value]="calculateDiscount(i)">

              </td>
              <td>
                <input type="number" required formControlName="amountHT" class="form-control col" id="amountHT" readonly [value]="calculateHT(i)">

              </td>
              <td>
                <input type="number" required formControlName="amountTVA" class="form-control col" id="amountTVA" readonly [value]="calculateTVA(i)">

              </td>
              <td>
                <input type="number" required formControlName="amountTTC" class="form-control col" id="amountTTC" readonly [value]="calculateTTC(i)">

              </td>
              <td>
                <input  (click)="removeProduct(i)" class="form-control col" type="button" value="Effacer">
              </td>

            </tr>
            <tr>
              <td colspan="4"></td>

              <td>
                <p>Total HT : {{totalHT|number:'1.3'}}</p>

              </td>
              <td>
                <p>Total TVA : {{totalTVA|number:'1.3'}}</p>
              </td>
              <td>
                <p>fiscal : {{bill.taxStamp|number:'1.3'}}</p>
              </td>
              <td>
                <p>Total TTC : {{totalTTC|number:'1.3'}}</p>
              </td>
              <td>
                <button type="button" class="btn btn-outline-secondary" (click)="pushProducts()" [disabled]="!productsForm.valid">Ajouter les articles</button>
              </td>
              <td>
                <button type="button" class="btn btn-outline-secondary" [routerLink]="['/bill-detail',bill.billId]" >Annuler</button>
              </td>
            </tr>




          </table>
        </div>

      </form>

    </div>

  </div>
</div>
<!-- Editable table -->
