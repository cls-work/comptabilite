<div class="m-3" >


  <div>
    <p>Réference facture : <b>{{bill.billId}}</b></p>
    <p>Fournisseur : {{bill.provider}}</p>
    <p>Date: : {{bill.date}}</p>

  </div>

  <div class="add-products-forms mt-5" [formGroup]="productsForm">
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" id="ht" (click)="editTax(0);calculateAllPrices()" checked name="taxType">
      <label class="form-check-label" for="ht">Hors Taxes</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" id="ttc" (click)="editTax(1);calculateAllPrices()" name="taxType">
      <label class="form-check-label" for="ttc">TTC</label>
    </div>
    <div class="row mt-3">
      <div class="col">Designation</div>
      <div class="col">Qté</div>
      <div class="col" *ngIf="taxType==0">Prix Unitaire HT</div>
      <div class="col" *ngIf="taxType==1">Prix Unitaire TTC</div>
      <div class="col">Réduction</div>
      <div class="col">TVA</div>
      <div class="col" *ngIf="taxType==0">Prix Unitaire HT après réduction</div>
      <div class="col" *ngIf="taxType==1">Prix Unitaire TTC après réduction</div>
      <div class="col">Montant HT</div>
      <div class="col">Montant TVA</div>
      <div class="col">Montant TTC</div>
      <div class="col"></div>
    </div>

    <div formArrayName="products" >
      <div *ngFor="let product of products.controls; let i=index">
        <div formGroupName="{{i}}" class="row">

          <input type="text" required formControlName="designation"
                 [class.alert-danger]="products.controls[i].controls.designation.invalid&&(products.controls[i].controls.designation.dirty||products.controls[i].controls.designation.touched)"
                 class="form-control col" placeholder="Désignation" aria-describedby="basic-addon2">



          <input type="number" required formControlName="quantity"
                 [class.alert-danger]="products.controls[i].controls.quantity.invalid&&(products.controls[i].controls.quantity.dirty||products.controls[i].controls.quantity.touched)"
                 class="form-control col" id="quantity" placeholder="Qté" (change)="calculatePrices(i)">


          <input type="number" required formControlName="unitPrice"
                 [class.alert-danger]="products.controls[i].controls.unitPrice.invalid&&(products.controls[i].controls.unitPrice.dirty||products.controls[i].controls.unitPrice.touched)"
                 class="form-control col" placeholder="Prix Unitaire" id="unitPrice" (change)="calculatePrices(i)">

          <div class="input-group col ">
            <input type="number" required formControlName="discount"
                   [class.alert-danger]="products.controls[i].controls.discount.invalid&&(products.controls[i].controls.discount.dirty||products.controls[i].controls.discount.touched)"
                   class="form-control col" id="discount" placeholder="Réduction" (change)="calculatePrices(i)">

            <div class="input-group-prepend">
                <span class="input-group-text" >%</span>
            </div>
          </div>

          <div class="input-group col ">
            <input type="number" required formControlName="tva"
                   [class.alert-danger]="products.controls[i].controls.tva.invalid&&(products.controls[i].controls.tva.dirty||products.controls[i].controls.tva.touched)"
                   class="form-control col" id="tva" (change)="calculatePrices(i)" placeholder="TVA">


            <div class="input-group-prepend">
              <span class="input-group-text" >%</span>
            </div>
          </div>

          <input type="number" required formControlName="unitPriceAfterDiscount" class="form-control col" id="unitPriceAfterDiscount" readonly [value]="calculateDiscount(i)">


          <input type="number" required formControlName="amountHT" class="form-control col" id="amountHT" readonly [value]="calculateHT(i)">


          <input type="number" required formControlName="amountTVA" class="form-control col" id="amountTVA" readonly [value]="calculateTVA(i)">


          <input type="number" required formControlName="amountTTC" class="form-control col" id="amountTTC" readonly [value]="calculateTTC(i)">
          <input  (click)="removeProduct(i)" class="form-control col" type="button" value="Effacer">
        </div>
      </div>
      <button type="submit" (click)="addProduct()" class="btn btn-secondary mt-1 add-button">Ajouter un article</button>
    </div>

    <div class="col-3 offset-9 mt-3">
      <p>Total HT : {{totalHT|number:'1.3'}}</p>
      <p>Total TVA : {{totalTVA|number:'1.3'}}</p>
      <p>fiscal : {{bill.taxStamp|number:'1.3'}}</p>
      <p>Total TTC : {{totalTTC|number:'1.3'}}</p>
      <div class="mb-1">
        <button type="button" class="btn btn-outline-secondary" (click)="pushProducts()" [disabled]="!productsForm.valid">Ajouter les articles</button>
      </div>
      <div>
        <button  type="button" class="btn btn-outline-secondary"  [routerLink]="['/bill-detail',bill.billId]">Annuler</button>
      </div>
    </div>
  </div>
</div>
